<!DOCTYPE html>
<html>
<head>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td{
  border: 1px solid #dddddd;
  text-align: left;
  padding: 6px;
  font-size: 12px;
}
    
th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 6px;
  font-size: 8px;
}
    
    
tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
</head>    
<body>
    
    
  <h2> CMS Provider Sample </h2>
  <p id="blurb">The table below is fetched dynamically using JavaScript. The data comes from the
    Centers for Medicare and Medicaid Services (CMS) Data API.
    
    It's a point in time snapshot of enrollment
    level data for providers actively enrolled in Medicare. The data is updated quarterly. 
    
   <p id="blurb"> For the purposes of this portfolio, I filtered the results to only show
     Medicare providers in PA with my last name.</p>
 
  <p id="demo"></p>

<script>

  // This data call stopped been working about 2 weeks after I wrote it. Reason? The API was in beta when I wrote this page,
  // but was quickly no longer beta. I removed the beta part of the url and it works again.
  // removed /beta from below
  //https://data.cms.gov/beta/data-api/v1/dataset/02c0692d-e2d9-4714-80c7-a1d16d72ec66/data
  
  
  // to learn more
  // https://data.cms.gov/api-docs
 
fetch('https://data.cms.gov/data-api/v1/dataset/2457ea29-fc82-48b0-86ec-3b0755de7515/data?filter[STATE_CD]=PA&filter[LAST_NAME]=SANDERS')
  .then(
    function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }

      console.log(response.headers.get('Content-Type'));
      console.log(response.headers.get('Date'));

      console.log(response.status);
      console.log(response.statusText);
      console.log(response.type);
      console.log(response.url);
        
      // Examine the text in the response
      response.json().then(function(jsonData) {
      var idx = 0;
      var txt = '';
      var td = '';
      var th ='';   
      var count =   Object.keys(jsonData).length -1  ;
      // VALUABLE METADATA
      console.log(Object.keys(jsonData[0]));
      
      // row   (outer loop)
      for(var i in jsonData){
         var key = i;
         var val = jsonData[i];
         
         // field in row (inner loop)
         for(var j in val){
            var sub_key = j;
            var sub_val = val[j];
           
            // Load table header into th 
            if (idx == 0){
                th += "<th>" + sub_key + "</th>";      
            } 
           
            td += "<td>" + sub_val + "</td>"; 
            
          } // end inner for loop
           
        
          // if first row, add headers   
          if (idx == 0){ txt +=  "<table><tr>" + th + "</tr>";   }   
       
          // too many rows break the page.
          if (idx < count) {
               txt  +=  "<tr>" + td + "</tr>";  
               td = '';
          } else {
                txt  +=  "<tr>" + td + "</tr>";  
                td = '';
                txt += "</table>"
                document.getElementById("demo").innerHTML += txt;
                
                break;
          }
          
          
      idx += 1;    
     } // end outer for loop
          
        
      });
    }
  )
  .catch(function(err) {
    console.log('Fetch Error :-S', err);
  });
</script>
</body>
</html>
